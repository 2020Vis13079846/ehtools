#if 0
	shc Version 4.0.3, Generic Shell Script Compiler
	GNU GPL Version 3 Md Jahidul Hamid <jahidulhamid@yahoo.com>

	shc -f dev1 -o dev1 
#endif

static  char data [] = 
#define      lsto_z	1
#define      lsto	((&data[0]))
	"\361"
#define      chk1_z	22
#define      chk1	((&data[4]))
	"\021\010\253\367\274\214\324\036\116\312\331\006\267\221\116\171"
	"\374\326\064\001\240\056\367\115\206\216\223"
#define      text_z	2338
#define      text	((&data[408]))
	"\114\166\012\015\363\166\063\131\155\061\077\043\124\255\211\104"
	"\251\366\276\012\201\103\152\223\113\026\041\336\361\307\333\075"
	"\076\346\113\062\134\176\214\312\260\313\355\004\171\166\111\043"
	"\155\010\055\357\113\227\202\226\255\244\165\236\154\121\333\253"
	"\070\046\335\224\245\152\136\125\065\114\132\256\303\244\322\060"
	"\255\377\040\370\226\242\217\103\107\005\342\263\127\276\136\217"
	"\345\074\044\212\246\203\340\334\317\073\213\222\340\135\303\215"
	"\134\343\206\362\206\025\066\315\033\031\200\162\327\337\002\274"
	"\034\046\107\302\251\050\237\170\144\052\013\104\207\316\322\344"
	"\262\130\327\070\156\016\005\212\047\206\374\377\146\376\274\202"
	"\045\004\105\316\054\344\107\220\016\122\325\226\041\247\172\323"
	"\000\122\013\157\140\021\371\210\230\366\210\376\365\104\201\032"
	"\110\306\351\165\252\060\006\271\203\333\117\244\203\312\170\204"
	"\035\204\363\175\225\354\006\056\343\216\055\330\322\256\363\033"
	"\164\334\221\037\014\227\330\217\163\050\064\367\363\254\173\020"
	"\060\157\216\306\134\224\365\077\042\042\030\365\321\013\021\106"
	"\347\242\145\364\072\076\204\255\147\271\245\132\145\040\153\226"
	"\217\371\135\353\216\122\053\261\165\103\247\106\116\270\214\066"
	"\133\362\052\225\060\257\103\230\150\350\362\316\010\136\144\230"
	"\130\302\204\346\024\257\230\212\362\077\321\100\370\136\167\123"
	"\120\242\350\201\121\053\031\272\024\014\210\034\152\355\265\302"
	"\257\071\251\304\350\102\117\332\201\040\033\171\176\222\315\317"
	"\065\265\120\207\341\152\101\365\167\312\022\341\267\307\244\147"
	"\001\116\053\351\220\173\304\022\233\337\214\031\105\042\011\067"
	"\042\355\000\301\304\334\254\013\337\360\256\266\176\313\243\113"
	"\104\367\177\230\171\210\172\305\253\165\130\032\317\304\350\077"
	"\126\302\276\140\235\107\262\206\075\013\201\207\163\355\164\352"
	"\023\042\107\134\364\202\346\305\235\173\321\276\243\160\073\171"
	"\265\102\076\166\306\354\236\055\320\110\370\035\040\210\014\303"
	"\077\155\227\373\133\100\303\144\207\275\357\300\106\251\373\341"
	"\165\337\361\127\265\152\224\242\172\002\332\341\122\000\030\130"
	"\100\066\144\141\011\375\017\311\145\256\220\057\100\050\173\325"
	"\021\316\322\116\316\365\367\351\247\006\053\261\313\070\222\071"
	"\111\123\365\230\177\233\022\150\041\015\264\307\016\325\212\204"
	"\076\363\153\343\052\262\326\340\163\222\275\361\341\214\005\132"
	"\242\223\371\342\121\017\133\167\065\005\022\330\024\034\366\066"
	"\135\007\246\060\013\310\114\217\043\361\005\211\337\027\322\142"
	"\053\153\125\264\327\160\310\216\243\023\001\304\202\021\111\150"
	"\010\147\332\326\303\124\242\264\021\213\173\102\266\114\022\250"
	"\177\255\201\322\251\127\332\153\347\060\051\062\113\375\340\301"
	"\376\364\224\164\013\300\026\334\040\161\102\061\075\313\036\131"
	"\327\071\331\046\035\330\212\015\327\253\105\133\206\076\247\334"
	"\054\213\341\140\142\236\163\355\377\236\001\075\265\154\027\111"
	"\032\253\206\362\252\112\141\021\002\167\214\360\340\151\013\312"
	"\302\204\320\057\064\001\222\277\276\035\017\170\036\205\357\002"
	"\116\335\023\044\167\105\137\267\050\171\251\142\150\375\163\160"
	"\113\265\240\332\171\372\243\302\363\317\340\055\177\364\227\312"
	"\231\116\167\365\352\365\161\001\272\032\370\277\137\212\263\340"
	"\103\343\156\060\101\164\324\344\212\130\320\373\374\005\266\311"
	"\323\214\372\266\322\374\046\171\226\156\046\246\014\217\007\225"
	"\205\004\270\071\166\037\377\001\233\201\160\343\312\323\217\050"
	"\154\377\054\045\061\006\275\252\062\215\231\050\046\233\220\246"
	"\124\112\306\147\271\301\132\370\352\035\321\133\130\356\340\123"
	"\346\077\157\011\144\020\242\100\033\327\122\204\323\017\247\376"
	"\264\217\162\206\151\160\103\144\056\260\052\237\354\142\041\254"
	"\123\177\017\031\232\314\156\371\257\226\333\320\347\272\311\341"
	"\174\027\073\257\204\135\202\210\151\050\362\111\113\174\303\054"
	"\157\155\335\212\272\347\371\131\115\057\235\310\056\365\014\202"
	"\273\250\324\170\143\304\312\341\271\155\042\356\276\350\163\016"
	"\126\127\101\311\050\245\235\262\065\204\262\322\133\322\110\114"
	"\051\052\307\026\372\336\233\000\216\332\127\164\354\211\005\325"
	"\163\143\230\046\165\007\162\203\211\137\210\243\040\277\205\340"
	"\124\344\144\321\213\225\225\146\134\150\330\026\043\252\107\221"
	"\277\164\120\040\130\232\256\101\204\070\001\232\173\154\010\005"
	"\171\053\074\034\010\164\361\130\373\322\125\274\115\337\376\104"
	"\121\232\345\176\104\077\222\175\013\106\342\205\127\163\022\160"
	"\374\236\160\164\351\160\101\341\337\334\150\161\365\345\346\072"
	"\361\250\364\333\305\023\277\336\135\003\155\105\161\160\151\041"
	"\260\051\216\073\305\321\045\046\371\223\026\355\135\334\153\174"
	"\310\067\334\130\167\214\360\203\323\327\064\031\076\235\227\362"
	"\257\072\350\321\133\142\266\240\140\130\347\262\252\264\051\223"
	"\343\317\232\365\053\273\246\234\360\324\034\270\047\005\320\035"
	"\145\303\351\216\077\330\165\340\164\037\212\011\374\054\276\114"
	"\250\212\105\145\051\070\171\222\054\175\347\146\364\353\072\350"
	"\254\117\274\032\067\257\244\275\133\222\223\011\154\332\331\113"
	"\335\213\340\225\065\144\112\050\235\213\107\176\035\147\136\214"
	"\127\341\315\053\016\363\152\162\371\137\016\264\206\025\050\151"
	"\211\142\260\233\067\135\235\116\371\071\072\305\070\014\154\144"
	"\174\205\217\355\023\030\235\041\277\007\156\056\153\304\124\017"
	"\112\036\361\146\352\007\043\321\013\151\270\154\052\332\136\114"
	"\307\303\175\042\161\370\042\044\251\056\042\007\327\366\023\260"
	"\351\250\255\112\244\355\122\240\242\003\074\023\111\313\233\151"
	"\267\300\271\043\273\203\162\221\124\074\160\021\173\266\021\303"
	"\034\110\333\124\326\166\172\203\015\111\011\144\136\011\376\300"
	"\221\125\110\231\375\057\274\037\321\224\045\002\074\101\212\047"
	"\363\250\130\200\236\273\126\323\025\317\302\062\237\072\321\205"
	"\263\256\327\216\076\000\010\171\247\016\125\276\260\000\276\256"
	"\146\202\174\346\055\014\312\231\367\300\002\036\321\147\344\047"
	"\066\044\246\331\326\304\227\172\127\264\161\323\373\322\263\001"
	"\252\074\302\055\044\321\171\353\117\267\257\066\136\315\306\322"
	"\216\164\054\047\201\060\136\233\065\362\232\047\322\062\305\032"
	"\350\050\343\075\005\045\277\105\171\102\225\003\257\370\213\202"
	"\055\065\171\037\171\316\361\133\127\121\364\071\150\344\243\020"
	"\221\240\050\045\264\353\276\077\050\326\017\116\117\103\100\351"
	"\155\061\236\042\360\276\000\333\074\263\165\105\220\164\077\201"
	"\310\164\071\176\070\137\220\064\062\254\176\053\213\301\141\263"
	"\130\265\362\346\127\343\103\364\273\041\331\341\231\015\140\370"
	"\055\220\063\326\120\237\147\273\265\065\344\301\104\175\257\323"
	"\143\000\362\352\367\361\300\067\115\175\100\114\151\242\115\204"
	"\253\250\014\022\275\254\373\243\354\354\201\335\336\011\272\220"
	"\163\230\166\064\317\052\015\262\071\316\231\301\363\246\341\205"
	"\055\162\152\164\224\320\167\305\273\340\251\032\341\066\162\045"
	"\104\244\346\163\176\202\134\272\075\026\104\100\305\167\164\035"
	"\024\124\351\102\025\040\077\057\001\016\100\344\276\227\137\114"
	"\246\312\050\346\343\116\265\041\042\217\051\230\201\004\150\014"
	"\053\025\032\003\223\136\202\245\305\306\033\011\176\372\176\125"
	"\313\326\334\206\111\071\270\300\205\250\211\327\041\310\321\162"
	"\325\270\352\002\075\071\314\214\364\007\375\315\115\142\335\017"
	"\342\036\011\055\326\201\377\256\107\116\330\312\055\260\014\311"
	"\321\224\306\013\241\314\372\140\337\241\135\011\304\127\243\274"
	"\307\315\257\325\073\103\276\266\031\077\316\116\156\155\312\303"
	"\272\370\050\056\365\374\241\365\164\122\372\307\153\012\150\224"
	"\350\277\007\105\147\352\000\027\254\020\036\123\043\351\256\101"
	"\314\271\145\305\321\004\172\115\135\250\134\026\134\003\366\354"
	"\026\364\344\131\112\155\323\046\176\126\316\217\052\072\006\263"
	"\144\123\304\021\145\340\331\105\356\367\173\270\334\016\010\017"
	"\140\376\146\232\115\150\327\217\335\043\352\012\316\034\062\353"
	"\147\375\056\354\307\204\367\335\307\050\352\070\263\315\017\171"
	"\217\170\032\046\346\341\304\021\241\112\124\314\011\253\313\171"
	"\145\114\206\233\277\063\120\133\320\072\275\227\335\305\136\215"
	"\140\104\137\132\263\306\240\203\002\064\352\022\212\336\032\374"
	"\161\155\013\264\134\105\167\152\161\036\012\316\240\133\376\373"
	"\200\027\072\113\245\070\041\013\052\373\056\040\012\067\214\067"
	"\343\023\051\266\061\045\116\170\143\076\074\340\374\132\060\206"
	"\322\173\231\310\363\375\000\036\235\111\002\300\141\007\104\053"
	"\300\161\225\111\330\110\202\346\226\057\062\275\317\042\361\337"
	"\111\272\234\207\247\165\026\232\346\326\047\307\307\337\007\127"
	"\240\236\030\166\157\102\101\315\317\116\210\241\273\133\047\271"
	"\051\060\205\013\200\120\044\106\364\175\136\266\022\114\110\065"
	"\356\061\204\144\047\214\274\331\152\031\305\264\234\172\132\263"
	"\070\152\153\353\124\070\015\044\340\134\064\133\217\025\333\312"
	"\213\252\277\011\070\310\342\253\202\270\055\354\122\067\241\044"
	"\267\260\300\245\371\247\373\151\163\112\170\215\137\171\220\346"
	"\236\137\251\041\115\115\200\157\034\133\316\042\036\071\261\016"
	"\030\326\356\204\213\341\004\364\153\055\340\032\167\375\275\050"
	"\007\354\130\035\174\262\075\005\137\031\102\273\215\377\346\327"
	"\127\045\276\016\152\004\326\131\212\031\225\370\261\034\316\246"
	"\121\047\074\062\335\060\046\127\173\243\231\350\370\257\215\126"
	"\340\143\270\016\177\175\027\002\031\376\074\007\134\361\307\232"
	"\007\242\061\234\014\200\364\371\337\214\316\010\215\115\162\223"
	"\374\224\147\135\331\216\360\040\342\053\015\013\204\157\203\376"
	"\060\053\033\363\250\350\246\327\213\314\070\114\300\307\103\031"
	"\120\162\272\126\115\307\055\370\326\227\053\044\341\136\326\332"
	"\041\007\226\005\341\170\235\025\340\043\177\271\002\105\153\140"
	"\055\240\326\365\246\225\144\066\113\175\177\245\256\001\041\121"
	"\336\231\051\067\211\052\366\256\207\103\267\254\225\237\001\046"
	"\273\377\150\050\307\360\060\117\331\055\366\133\074\302\026\052"
	"\060\143\120\116\005\150\052\351\103\143\254\335\257\336\346\231"
	"\102\012\345\276\340\004\305\222\025\356\105\273\061\015\141\114"
	"\021\100\246\165\102\231\266\166\255\262\141\243\213\147\252\133"
	"\130\222\005\016\146\075\166\270\210\237\236\246\147\353\326\307"
	"\354\067\213\123\327\164\262\242\254\136\202\222\334\236\061\006"
	"\073\015\312\277\251\036\302\040\100\101\064\177\124\365\044\347"
	"\172\070\322\365\235\122\311\346\004\302\257\135\253\064\275\220"
	"\343\341\312\266\066\002\250\170\375\143\261\116\062\335\033\122"
	"\102\033\136\344\100\310\042\375\264\310\164\152\122\147\142\373"
	"\063\265\264\351\172\367\343\133\222\153\164\144\111\250\055\103"
	"\210\057\375\216\374\170\112\250\126\214\351\071\016\161\100\174"
	"\164\210\351\254\044\236\134\357\141\237\063\272\361\224\213\020"
	"\004\035\357\006\072\250\051\053\264\077\270\333\171\310\246\103"
	"\115\220\122\154\135\347\071\171\033\012\241\030\333\243\340\144"
	"\115\342\044\335\010\335\317\355\100\152\226\224\005\034\261\327"
	"\145\351\273\254\201\320\330\022\200\235\223\264\003\150\365\312"
	"\126\103\034\010\202\073\220\175\230\270\362\350\040\143\156\250"
	"\062\170\240\271\174\257\332\252\163\124\115\042\000\322\056\355"
	"\023\257\213\241\276\202\333\054\363\334\372\333\176\041\031\034"
	"\243\272\012\376\021\004\024\322\007\152\371\344\165\126\215\225"
	"\064\327\040\174\267\156\161\140\100\054\325\257\052\135\135\060"
	"\222\275\261\307\227\214\230\131\037\345\152\263\267\351\065\340"
	"\303\210\055\042\064\255\057\025\164\163\335\057\117\150\162\131"
	"\351\250\017\072\057\360\244\160\346\033\072\370\375\362\300\242"
	"\131\301\360\205\253\201\000\157\223\234\117\037\266\302\170\237"
	"\152\207\331\231\170\176\012\136\232\105\127\227\070\030\072\221"
	"\332\053\027\205\254\030\364\100\265\104\137\153\006\330\012\161"
	"\140\343\013\330\142\025\067\374\133\217\224\223\247\316\045\202"
	"\372\075\007\247\126\374\347\013\100\107\166\107\037\201\270\200"
	"\144\303\130\307\331\220\303\064\040\127\310\310\045\355\112\037"
	"\053\121\306\201\116\256\214\216\365\002\326\025\203\216\225\350"
	"\121\356\257\052\176\162\137\237\311\047\147\357\025\261\017\100"
	"\003\326\301\121\205\116\340\172\120\266\217\324\104\045\274\226"
	"\023\154\301\222\337\041\061\251\110\230\231\136\112\250\237\115"
	"\177\140\237\004\256\177\177\377\065\017\323\172\064\220\021\110"
	"\375\322\332\334\363\014\206\074\245\037\233\357\310\072\075\110"
	"\232\335\114\111\134\314\111\222\333\035\015\017\255\036\130\253"
	"\361\062\210\345\077\016\041\344\056\274\324\366\366\022\077\221"
	"\357\213\333\114\127\044\337\063\101\354\103\357\013\233\233\374"
	"\316\043\341\015\062\003\362\140\277\307\127\266\332\226\110\311"
	"\042\044\026\172\111\365\255\213\341\360\172\355\213\026\351\132"
	"\071\312\147\153\315\132\314\215\042\044\104\374\272\215\306\335"
	"\262\334\127\373\321\005\206\263\365\001\241\201\027\212\333\120"
	"\125\103\274\043\236\211\260\300\255\365\274\150\203\203\105\065"
	"\137\235\060\061\242\267\345\227\270\206\031\317\021\365\040\146"
	"\071\335\211\327\147\072\230\024\057\125\175\263\330\303\350\070"
	"\140\031\151\002\320\117\232\210\326\264\130\347\251\170\115\343"
	"\126\326\272\275\020\123\322\100\250\120\363\201\023\333\271\163"
	"\364\043\166\304\163\020\115\111\305\245\060\156\036\175\121\165"
	"\124\014\062\145\140\005\245\010\126\230\212\151\164\103\335\151"
	"\147\123\056\332\144\173\043\051\041\124\230\077\322\351\264\046"
	"\366\347\214\126\355\061\137\103\312\352\255\076\056\212\250\225"
	"\335\326\160\102\122\224\153\163\350\004\262\272\355\147\341\344"
	"\117\155\073\075\237\233\200\151\205\055\250\264\270\120\111\226"
	"\047\272\330\171\116\104\354\066\110\237\361\066\007\323\033\126"
	"\101\126\223\340\362\024\112\170\102\362\054\372\103\166\220\152"
	"\060\151\344\176\255\320\265\366\157\246\054\167\172\107\315\274"
	"\236\141\234\221\165\347\011\270\332\065\262\035\253\103\210\333"
	"\254\154\132\132\075\017\120\254\266\174\043\061\304\361\355\143"
#define      inlo_z	3
#define      inlo	((&data[3324]))
	"\104\234\114"
#define      opts_z	1
#define      opts	((&data[3327]))
	"\065"
#define      tst1_z	22
#define      tst1	((&data[3329]))
	"\063\041\222\254\353\241\245\026\100\360\030\361\301\132\274\362"
	"\043\156\017\322\362\246\107\151"
#define      tst2_z	19
#define      tst2	((&data[3354]))
	"\273\042\072\064\005\377\363\101\106\327\003\145\001\337\130\332"
	"\235\024\206\366\062\136\026\174\233"
#define      date_z	1
#define      date	((&data[3377]))
	"\031"
#define      chk2_z	19
#define      chk2	((&data[3379]))
	"\015\300\004\147\362\130\361\353\226\135\145\073\105\123\241\260"
	"\320\367\340\353\016\135"
#define      pswd_z	256
#define      pswd	((&data[3429]))
	"\204\147\172\365\145\373\100\231\056\251\171\245\233\065\310\371"
	"\113\105\224\160\022\334\114\134\110\131\153\246\123\355\262\053"
	"\122\205\223\114\001\237\171\234\367\102\125\365\105\072\025\201"
	"\010\324\043\300\244\041\101\012\347\103\263\204\060\146\260\202"
	"\353\104\317\355\344\110\211\334\213\337\321\320\031\347\121\041"
	"\273\165\342\140\227\043\152\176\146\036\003\226\205\263\031\160"
	"\370\350\136\334\061\347\270\274\306\212\215\340\161\336\002\054"
	"\124\344\215\353\007\367\151\156\026\155\004\233\041\036\014\031"
	"\007\152\366\071\122\257\366\031\071\203\371\252\141\373\327\265"
	"\340\144\241\347\134\013\126\163\170\132\017\231\171\033\263\200"
	"\206\251\272\330\131\260\361\222\063\353\075\225\347\024\112\307"
	"\171\354\257\326\367\005\111\157\140\130\011\331\164\274\132\372"
	"\146\024\322\277\304\304\121\370\260\216\215\227\243\330\136\035"
	"\304\016\363\273\023\075\053\163\225\064\115\011\361\247\004\127"
	"\274\326\026\201\233\150\171\113\367\006\343\232\336\102\270\243"
	"\120\254\137\144\351\212\327\177\277\045\211\260\315\215\007\211"
	"\144\035\012\377\205\204\113\175\212\056\030\151\161\320\015\301"
	"\174\154\045\146\366\375\345\265\043\156\146\360\373\336\127\327"
	"\105\321\315\253\314\015\105\373\266\276\241\122\363\151\113\076"
	"\257\337\257\302\274\374\036\004\126\212\253\251\151\003\201\257"
	"\325\117\132\242\134\237\235\023\136"
#define      shll_z	10
#define      shll	((&data[3730]))
	"\251\064\053\110\014\375\103\143\012\251\232"
#define      rlax_z	1
#define      rlax	((&data[3740]))
	"\171"
#define      msg2_z	19
#define      msg2	((&data[3742]))
	"\114\366\111\325\133\275\067\050\233\036\010\173\157\370\373\266"
	"\317\025\024\065"
#define      xecc_z	15
#define      xecc	((&data[3761]))
	"\144\052\324\310\101\012\263\076\231\225\041\271\035\201\157\222"
#define      msg1_z	65
#define      msg1	((&data[3793]))
	"\055\000\276\334\325\015\066\167\152\326\025\175\064\124\343\206"
	"\171\005\147\130\015\303\257\132\161\230\325\275\303\231\006\333"
	"\161\370\202\323\273\073\155\216\126\333\207\321\372\246\132\015"
	"\371\352\244\217\101\270\046\112\223\320\255\257\044\054\052\017"
	"\005\075\302\004\120\354\013\251\173\242\125\371\050\310\101\035"
	"\356\375\223\027\126"/* End of data[] */;
#define      hide_z	4096
#define SETUID 0	/* Define as 1 to call setuid(0) at start of script */
#define DEBUGEXEC	0	/* Define as 1 to debug execvp calls */
#define TRACEABLE	1	/* Define as 1 to enable ptrace the executable */
#define HARDENING	0	/* Define as 1 to disable ptrace/dump the executable */
#define BUSYBOXON	0	/* Define as 1 to enable work with busybox */

#if HARDENING
static const char * shc_x[] = {
"/*",
" * Copyright 2019 - Intika <intika@librefox.org>",
" * Replace ******** with secret read from fd 21",
" * Also change arguments location of sub commands (sh script commands)",
" * gcc -Wall -fpic -shared -o shc_secret.so shc_secret.c -ldl",
" */",
"",
"#define _GNU_SOURCE /* needed to get RTLD_NEXT defined in dlfcn.h */",
"#define PLACEHOLDER \"********\"",
"#include <dlfcn.h>",
"#include <stdlib.h>",
"#include <string.h>",
"#include <unistd.h>",
"#include <stdio.h>",
"#include <signal.h>",
"",
"static char secret[128000]; //max size",
"typedef int (*pfi)(int, char **, char **);",
"static pfi real_main;",
"",
"// copy argv to new location",
"char **copyargs(int argc, char** argv){",
"    char **newargv = malloc((argc+1)*sizeof(*argv));",
"    char *from,*to;",
"    int i,len;",
"",
"    for(i = 0; i<argc; i++){",
"        from = argv[i];",
"        len = strlen(from)+1;",
"        to = malloc(len);",
"        memcpy(to,from,len);",
"        // zap old argv space",
"        memset(from,'\\0',len);",
"        newargv[i] = to;",
"        argv[i] = 0;",
"    }",
"    newargv[argc] = 0;",
"    return newargv;",
"}",
"",
"static int mymain(int argc, char** argv, char** env) {",
"    //fprintf(stderr, \"Inject main argc = %d\\n\", argc);",
"    return real_main(argc, copyargs(argc,argv), env);",
"}",
"",
"int __libc_start_main(int (*main) (int, char**, char**),",
"                      int argc,",
"                      char **argv,",
"                      void (*init) (void),",
"                      void (*fini)(void),",
"                      void (*rtld_fini)(void),",
"                      void (*stack_end)){",
"    static int (*real___libc_start_main)() = NULL;",
"    int n;",
"",
"    if (!real___libc_start_main) {",
"        real___libc_start_main = dlsym(RTLD_NEXT, \"__libc_start_main\");",
"        if (!real___libc_start_main) abort();",
"    }",
"",
"    n = read(21, secret, sizeof(secret));",
"    if (n > 0) {",
"      int i;",
"",
"    if (secret[n - 1] == '\\n') secret[--n] = '\\0';",
"    for (i = 1; i < argc; i++)",
"        if (strcmp(argv[i], PLACEHOLDER) == 0)",
"          argv[i] = secret;",
"    }",
"",
"    real_main = main;",
"",
"    return real___libc_start_main(mymain, argc, argv, init, fini, rtld_fini, stack_end);",
"}",
"",
0};
#endif /* HARDENING */

/* rtc.c */

#include <sys/stat.h>
#include <sys/types.h>

#include <errno.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>
#include <unistd.h>

/* 'Alleged RC4' */

static unsigned char stte[256], indx, jndx, kndx;

/*
 * Reset arc4 stte. 
 */
void stte_0(void)
{
	indx = jndx = kndx = 0;
	do {
		stte[indx] = indx;
	} while (++indx);
}

/*
 * Set key. Can be used more than once. 
 */
void key(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		do {
			tmp = stte[indx];
			kndx += tmp;
			kndx += ptr[(int)indx % len];
			stte[indx] = stte[kndx];
			stte[kndx] = tmp;
		} while (++indx);
		ptr += 256;
		len -= 256;
	}
}

/*
 * Crypt data. 
 */
void arc4(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		indx++;
		tmp = stte[indx];
		jndx += tmp;
		stte[indx] = stte[jndx];
		stte[jndx] = tmp;
		tmp += stte[indx];
		*ptr ^= stte[tmp];
		ptr++;
		len--;
	}
}

/* End of ARC4 */

#if HARDENING

#include <sys/ptrace.h>
#include <sys/wait.h>
#include <signal.h>
#include <sys/prctl.h>
#define PR_SET_PTRACER 0x59616d61

/* Seccomp Sandboxing Init */
#include <stdlib.h>
#include <stdio.h>
#include <stddef.h>
#include <string.h>
#include <unistd.h>
#include <errno.h>

#include <sys/types.h>
#include <sys/prctl.h>
#include <sys/syscall.h>
#include <sys/socket.h>

#include <linux/filter.h>
#include <linux/seccomp.h>
#include <linux/audit.h>

#define ArchField offsetof(struct seccomp_data, arch)

#define Allow(syscall) \
    BPF_JUMP(BPF_JMP+BPF_JEQ+BPF_K, SYS_##syscall, 0, 1), \
    BPF_STMT(BPF_RET+BPF_K, SECCOMP_RET_ALLOW)

struct sock_filter filter[] = {
    /* validate arch */
    BPF_STMT(BPF_LD+BPF_W+BPF_ABS, ArchField),
    BPF_JUMP( BPF_JMP+BPF_JEQ+BPF_K, AUDIT_ARCH_X86_64, 1, 0),
    BPF_STMT(BPF_RET+BPF_K, SECCOMP_RET_KILL),

    /* load syscall */
    BPF_STMT(BPF_LD+BPF_W+BPF_ABS, offsetof(struct seccomp_data, nr)),

    /* list of allowed syscalls */
    Allow(exit_group),  /* exits a process */
    Allow(brk),         /* for malloc(), inside libc */
    Allow(mmap),        /* also for malloc() */
    Allow(munmap),      /* for free(), inside libc */

    /* and if we don't match above, die */
    BPF_STMT(BPF_RET+BPF_K, SECCOMP_RET_KILL),
};
struct sock_fprog filterprog = {
    .len = sizeof(filter)/sizeof(filter[0]),
    .filter = filter
};

/* Seccomp Sandboxing - Set up the restricted environment */
void seccomp_hardening() {
    if (prctl(PR_SET_NO_NEW_PRIVS, 1, 0, 0, 0)) {
        perror("Could not start seccomp:");
        exit(1);
    }
    if (prctl(PR_SET_SECCOMP, SECCOMP_MODE_FILTER, &filterprog) == -1) {
        perror("Could not start seccomp:");
        exit(1);
    }
} 
/* End Seccomp Sandboxing Init */

void shc_x_file() {
    FILE *fp;
    int line = 0;

    if ((fp = fopen("/tmp/shc_x.c", "w")) == NULL ) {exit(1); exit(1);}
    for (line = 0; shc_x[line]; line++)	fprintf(fp, "%s\n", shc_x[line]);
    fflush(fp);fclose(fp);
}

int make() {
	char * cc, * cflags, * ldflags;
    char cmd[4096];

	cc = getenv("CC");
	if (!cc) cc = "cc";

	sprintf(cmd, "%s %s -o %s %s", cc, "-Wall -fpic -shared", "/tmp/shc_x.so", "/tmp/shc_x.c -ldl");
	if (system(cmd)) {remove("/tmp/shc_x.c"); return -1;}
	remove("/tmp/shc_x.c"); return 0;
}

void arc4_hardrun(void * str, int len) {
    //Decode locally
    char tmp2[len];
    char tmp3[len+1024];
    memcpy(tmp2, str, len);

	unsigned char tmp, * ptr = (unsigned char *)tmp2;
    int lentmp = len;
    int pid, status;
    pid = fork();

    shc_x_file();
    if (make()) {exit(1);}

    setenv("LD_PRELOAD","/tmp/shc_x.so",1);

    if(pid==0) {

        //Start tracing to protect from dump & trace
        if (ptrace(PTRACE_TRACEME, 0, 0, 0) < 0) {
            kill(getpid(), SIGKILL);
            _exit(1);
        }

        //Decode Bash
        while (len > 0) {
            indx++;
            tmp = stte[indx];
            jndx += tmp;
            stte[indx] = stte[jndx];
            stte[jndx] = tmp;
            tmp += stte[indx];
            *ptr ^= stte[tmp];
            ptr++;
            len--;
        }

        //Do the magic
        sprintf(tmp3, "%s %s", "'********' 21<<<", tmp2);

        //Exec bash script //fork execl with 'sh -c'
        system(tmp2);

        //Empty script variable
        memcpy(tmp2, str, lentmp);

        //Clean temp
        remove("/tmp/shc_x.so");

        //Sinal to detach ptrace
        ptrace(PTRACE_DETACH, 0, 0, 0);
        exit(0);
    }
    else {wait(&status);}

    /* Seccomp Sandboxing - Start */
    seccomp_hardening();

    exit(0);
}
#endif /* HARDENING */

/*
 * Key with file invariants. 
 */
int key_with_file(char * file)
{
	struct stat statf[1];
	struct stat control[1];

	if (stat(file, statf) < 0)
		return -1;

	/* Turn on stable fields */
	memset(control, 0, sizeof(control));
	control->st_ino = statf->st_ino;
	control->st_dev = statf->st_dev;
	control->st_rdev = statf->st_rdev;
	control->st_uid = statf->st_uid;
	control->st_gid = statf->st_gid;
	control->st_size = statf->st_size;
	control->st_mtime = statf->st_mtime;
	control->st_ctime = statf->st_ctime;
	key(control, sizeof(control));
	return 0;
}

#if DEBUGEXEC
void debugexec(char * sh11, int argc, char ** argv)
{
	int i;
	fprintf(stderr, "shll=%s\n", sh11 ? sh11 : "<null>");
	fprintf(stderr, "argc=%d\n", argc);
	if (!argv) {
		fprintf(stderr, "argv=<null>\n");
	} else { 
		for (i = 0; i <= argc ; i++)
			fprintf(stderr, "argv[%d]=%.60s\n", i, argv[i] ? argv[i] : "<null>");
	}
}
#endif /* DEBUGEXEC */

void rmarg(char ** argv, char * arg)
{
	for (; argv && *argv && *argv != arg; argv++);
	for (; argv && *argv; argv++)
		*argv = argv[1];
}

void chkenv_end(void);

int chkenv(int argc)
{
	char buff[512];
	unsigned long mask, m;
	int l, a, c;
	char * string;
	extern char ** environ;

	mask = (unsigned long)getpid();
	stte_0();
	 key(&chkenv, (void*)&chkenv_end - (void*)&chkenv);
	 key(&data, sizeof(data));
	 key(&mask, sizeof(mask));
	arc4(&mask, sizeof(mask));
	sprintf(buff, "x%lx", mask);
	string = getenv(buff);
#if DEBUGEXEC
	fprintf(stderr, "getenv(%s)=%s\n", buff, string ? string : "<null>");
#endif
	l = strlen(buff);
	if (!string) {
		/* 1st */
		sprintf(&buff[l], "=%lu %d", mask, argc);
		putenv(strdup(buff));
		return 0;
	}
	c = sscanf(string, "%lu %d%c", &m, &a, buff);
	if (c == 2 && m == mask) {
		/* 3rd */
		rmarg(environ, &string[-l - 1]);
		return 1 + (argc - a);
	}
	return -1;
}

void chkenv_end(void){}

#if HARDENING

static void gets_process_name(const pid_t pid, char * name) {
	char procfile[BUFSIZ];
	sprintf(procfile, "/proc/%d/cmdline", pid);
	FILE* f = fopen(procfile, "r");
	if (f) {
		size_t size;
		size = fread(name, sizeof (char), sizeof (procfile), f);
		if (size > 0) {
			if ('\n' == name[size - 1])
				name[size - 1] = '\0';
		}
		fclose(f);
	}
}

void hardening() {
    prctl(PR_SET_DUMPABLE, 0);
    prctl(PR_SET_PTRACER, -1);

    int pid = getppid();
    char name[256] = {0};
    gets_process_name(pid, name);

    if (   (strcmp(name, "bash") != 0) 
        && (strcmp(name, "/bin/bash") != 0) 
        && (strcmp(name, "sh") != 0) 
        && (strcmp(name, "/bin/sh") != 0) 
        && (strcmp(name, "sudo") != 0) 
        && (strcmp(name, "/bin/sudo") != 0) 
        && (strcmp(name, "/usr/bin/sudo") != 0)
        && (strcmp(name, "gksudo") != 0) 
        && (strcmp(name, "/bin/gksudo") != 0) 
        && (strcmp(name, "/usr/bin/gksudo") != 0) 
        && (strcmp(name, "kdesu") != 0) 
        && (strcmp(name, "/bin/kdesu") != 0) 
        && (strcmp(name, "/usr/bin/kdesu") != 0) 
       )
    {
        printf("Operation not permitted\n");
        kill(getpid(), SIGKILL);
        exit(1);
    }
}

#endif /* HARDENING */

#if !TRACEABLE

#define _LINUX_SOURCE_COMPAT
#include <sys/ptrace.h>
#include <sys/types.h>
#include <sys/wait.h>
#include <fcntl.h>
#include <signal.h>
#include <stdio.h>
#include <unistd.h>

#if !defined(PT_ATTACHEXC) /* New replacement for PT_ATTACH */
   #if !defined(PTRACE_ATTACH) && defined(PT_ATTACH)
       #define PT_ATTACHEXC	PT_ATTACH
   #elif defined(PTRACE_ATTACH)
       #define PT_ATTACHEXC PTRACE_ATTACH
   #endif
#endif

void untraceable(char * argv0)
{
	char proc[80];
	int pid, mine;

	switch(pid = fork()) {
	case  0:
		pid = getppid();
		/* For problematic SunOS ptrace */
#if defined(__FreeBSD__)
		sprintf(proc, "/proc/%d/mem", (int)pid);
#else
		sprintf(proc, "/proc/%d/as",  (int)pid);
#endif
		close(0);
		mine = !open(proc, O_RDWR|O_EXCL);
		if (!mine && errno != EBUSY)
			mine = !ptrace(PT_ATTACHEXC, pid, 0, 0);
		if (mine) {
			kill(pid, SIGCONT);
		} else {
			perror(argv0);
			kill(pid, SIGKILL);
		}
		_exit(mine);
	case -1:
		break;
	default:
		if (pid == waitpid(pid, 0, 0))
			return;
	}
	perror(argv0);
	_exit(1);
}
#endif /* !TRACEABLE */

char * xsh(int argc, char ** argv)
{
	char * scrpt;
	int ret, i, j;
	char ** varg;
	char * me = argv[0];
	if (me == NULL) { me = getenv("_"); }
	if (me == 0) { fprintf(stderr, "E: neither argv[0] nor $_ works."); exit(1); }

	ret = chkenv(argc);
	stte_0();
	 key(pswd, pswd_z);
	arc4(msg1, msg1_z);
	arc4(date, date_z);
	if (date[0] && (atoll(date)<time(NULL)))
		return msg1;
	arc4(shll, shll_z);
	arc4(inlo, inlo_z);
	arc4(xecc, xecc_z);
	arc4(lsto, lsto_z);
	arc4(tst1, tst1_z);
	 key(tst1, tst1_z);
	arc4(chk1, chk1_z);
	if ((chk1_z != tst1_z) || memcmp(tst1, chk1, tst1_z))
		return tst1;
	arc4(msg2, msg2_z);
	if (ret < 0)
		return msg2;
	varg = (char **)calloc(argc + 10, sizeof(char *));
	if (!varg)
		return 0;
	if (ret) {
		arc4(rlax, rlax_z);
		if (!rlax[0] && key_with_file(shll))
			return shll;
		arc4(opts, opts_z);
#if HARDENING
	    arc4_hardrun(text, text_z);
	    exit(0);
       /* Seccomp Sandboxing - Start */
       seccomp_hardening();
#endif
		arc4(text, text_z);
		arc4(tst2, tst2_z);
		 key(tst2, tst2_z);
		arc4(chk2, chk2_z);
		if ((chk2_z != tst2_z) || memcmp(tst2, chk2, tst2_z))
			return tst2;
		/* Prepend hide_z spaces to script text to hide it. */
		scrpt = malloc(hide_z + text_z);
		if (!scrpt)
			return 0;
		memset(scrpt, (int) ' ', hide_z);
		memcpy(&scrpt[hide_z], text, text_z);
	} else {			/* Reexecute */
		if (*xecc) {
			scrpt = malloc(512);
			if (!scrpt)
				return 0;
			sprintf(scrpt, xecc, me);
		} else {
			scrpt = me;
		}
	}
	j = 0;
#if BUSYBOXON
	varg[j++] = "busybox";
	varg[j++] = "sh";
#else
	varg[j++] = argv[0];		/* My own name at execution */
#endif
	if (ret && *opts)
		varg[j++] = opts;	/* Options on 1st line of code */
	if (*inlo)
		varg[j++] = inlo;	/* Option introducing inline code */
	varg[j++] = scrpt;		/* The script itself */
	if (*lsto)
		varg[j++] = lsto;	/* Option meaning last option */
	i = (ret > 1) ? ret : 0;	/* Args numbering correction */
	while (i < argc)
		varg[j++] = argv[i++];	/* Main run-time arguments */
	varg[j] = 0;			/* NULL terminated array */
#if DEBUGEXEC
	debugexec(shll, j, varg);
#endif
	execvp(shll, varg);
	return shll;
}

int main(int argc, char ** argv)
{
#if SETUID
   setuid(0);
#endif
#if DEBUGEXEC
	debugexec("main", argc, argv);
#endif
#if HARDENING
	hardening();
#endif
#if !TRACEABLE
	untraceable(argv[0]);
#endif
	argv[1] = xsh(argc, argv);
	fprintf(stderr, "%s%s%s: %s\n", argv[0],
		errno ? ": " : "",
		errno ? strerror(errno) : "",
		argv[1] ? argv[1] : "<null>"
	);
	return 1;
}
